<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin - Centro Yoga Roma</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    overflow: hidden;
}

.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

.header h1 {
    font-size: 2em;
    margin-bottom: 10px;
}

.tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 2px solid #e0e0e0;
    overflow-x: auto;
}

.tab {
    flex: 1;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 600;
    border: none;
    background: transparent;
    min-width: 150px;
}

.tab:hover {
    background: #e9ecef;
}

.tab.active {
    background: white;
    border-bottom: 3px solid #667eea;
    color: #667eea;
}

.content {
    padding: 30px;
}

.section {
    display: none;
}

.section.active {
    display: block;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border 0.3s;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.btn {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-success {
    background: #28a745;
    color: white;
}

.card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    border-left: 4px solid #667eea;
}

.card h3 {
    margin-bottom: 15px;
    color: #333;
}

.item {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

.item-info {
    flex: 1;
    min-width: 250px;
}

.item-info h4 {
    margin-bottom: 8px;
    color: #667eea;
}

.item-info p {
    margin: 5px 0;
    color: #666;
    font-size: 14px;
}

.actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.actions button {
    padding: 8px 16px;
    font-size: 14px;
}

.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
}

.stat-card h3 {
    font-size: 2.5em;
    margin-bottom: 10px;
}

.stat-card p {
    opacity: 0.9;
}

.alert {
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.hidden {
    display: none;
}

.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.loading {
    text-align: center;
    padding: 40px;
    color: #666;
}

@media (max-width: 768px) {
    .grid-2 {
        grid-template-columns: 1fr;
    }
    
    .item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .actions {
        margin-top: 15px;
        width: 100%;
    }
    
    .actions button {
        flex: 1;
    }
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>Pannello Admin</h1>
<p>Centro Yoga Roma</p>
<button id="logout-button" class="btn btn-danger" style="margin-top: 20px; display: none;">Esci</button>
</div>

<div id="main-content" style="display: none;">
<div class="tabs">
<button class="tab active" onclick="showTab('dashboard')">Dashboard</button>
<button class="tab" onclick="showTab('classes')">Lezioni</button>
<button class="tab" onclick="showTab('bookings')">Prenotazioni</button>
<button class="tab" onclick="showTab('content')">Contenuti</button>
<button class="tab" onclick="showTab('styles')">Stili Yoga</button>
<button class="tab" onclick="showTab('testimonials')">Testimonial</button>
</div>

<div class="content">
<div id="dashboard" class="section active">
<h2 style="margin-bottom: 20px;">Dashboard</h2>

<div class="stats">
<div class="stat-card">
<h3 id="totalClasses">-</h3>
<p>Lezioni Attive</p>
</div>
<div class="stat-card">
<h3 id="totalBookings">-</h3>
<p>Prenotazioni Totali</p>
</div>
<div class="stat-card">
<h3 id="todayBookings">-</h3>
<p>Prenotazioni Oggi</p>
</div>
<div class="stat-card">
<h3 id="availableSpots">-</h3>
<p>Posti Disponibili</p>
</div>
</div>

<div class="card">
<h3>Azioni Rapide</h3>
<div style="display: flex; gap: 15px; flex-wrap: wrap;">
<button class="btn btn-primary" onclick="showTab('classes')">Aggiungi Lezione</button>
<button class="btn btn-primary" onclick="showTab('bookings')">Vedi Prenotazioni</button>
<button class="btn btn-primary" onclick="showTab('content')">Modifica Contenuti</button>
</div>
</div>
</div>

<div id="classes" class="section">
<h2 style="margin-bottom: 20px;">Gestione Lezioni</h2>

<div id="classAlert" class="hidden"></div>

<div class="card">
<h3>Aggiungi Nuova Lezione</h3>
<form id="classForm">
<div class="grid-2">
<div class="form-group">
<label>Nome Lezione *</label>
<input type="text" id="className" placeholder="es. Hatha Yoga Mattutino" required>
</div>
<div class="form-group">
<label>Insegnante *</label>
<input type="text" id="classInstructor" placeholder="es. Maria Rossi" required>
</div>
</div>

<div class="grid-2">
<div class="form-group">
<label>Giorno *</label>
<input type="text" id="classDay" placeholder="es. Lunedì e Mercoledì" required>
</div>
<div class="form-group">
<label>Orario *</label>
<input type="text" id="classTime" placeholder="es. 09:00-10:30" required>
</div>
</div>

<div class="grid-2">
<div class="form-group">
<label>Livello *</label>
<select id="classLevel" required>
<option value="">Seleziona livello</option>
<option value="Principiante">Principiante</option>
<option value="Intermedio">Intermedio</option>
<option value="Avanzato">Avanzato</option>
<option value="Tutti i livelli">Tutti i livelli</option>
</select>
</div>
<div class="form-group">
<label>Posti Max *</label>
<input type="number" id="classSpots" placeholder="es. 15" min="1" required>
</div>
</div>

<div class="form-group">
<label>Prezzo (€) *</label>
<input type="number" id="classPrice" placeholder="es. 20" min="0" step="0.01" required>
</div>

<div class="form-group">
<label>Descrizione</label>
<textarea id="classDescription" placeholder="Descrizione della lezione..."></textarea>
</div>

<button type="submit" class="btn btn-primary">Salva Lezione</button>
</form>
</div>

<div class="card">
<h3>Lezioni Attive</h3>
<div id="classesList" class="loading">Caricamento lezioni...</div>
</div>
</div>

<div id="bookings" class="section">
<h2 style="margin-bottom: 20px;">Gestione Prenotazioni</h2>

<div class="card">
<h3>Prenotazioni Recenti</h3>
<div id="bookingsList" class="loading">Caricamento prenotazioni...</div>
</div>
</div>

<div id="content" class="section">
<h2 style="margin-bottom: 20px;">Gestione Contenuti Sito</h2>

<div id="contentAlert" class="hidden"></div>

<div class="card">
<h3>Homepage</h3>
<form id="homepageForm">
<div class="form-group">
<label>Titolo Principale</label>
<input type="text" id="homeTitle" placeholder="es. Centro Yoga Roma">
</div>
<div class="form-group">
<label>Sottotitolo</label>
<textarea id="homeSubtitle" placeholder="es. Trova il tuo equilibrio"></textarea>
</div>
<div class="form-group">
<label>Descrizione Hero</label>
<textarea id="homeDescription" placeholder="Descrizione della sezione iniziale..."></textarea>
</div>
<div class="form-group">
<label>Titolo Sezione Stili</label>
<input type="text" id="homeStylesTitle" placeholder="es. I Nostri Stili di Yoga">
</div>
<div class="form-group">
<label>Sottotitolo Sezione Stili</label>
<textarea id="homeStylesSubtitle" placeholder="es. Trova la pratica perfetta per te."></textarea>
</div>
<div class="form-group">
<label>Titolo Sezione Testimonial</label>
<input type="text" id="homeTestimonialsTitle" placeholder="es. Cosa Dicono di Noi">
</div>
<div class="form-group">
<label>Titolo Sezione Orario</label>
<input type="text" id="homeScheduleTitle" placeholder="es. Orario dei Corsi">
</div>
<div class="form-group">
<label>Sottotitolo Sezione Orario</label>
<textarea id="homeScheduleSubtitle" placeholder="es. Un'anteprima delle nostre lezioni settimanali."></textarea>
</div>
<button type="submit" class="btn btn-primary">Salva Contenuti Homepage</button>
</form>
</div>

<div class="card">
<h3>Informazioni Contatto e Footer</h3>
<form id="footerForm">
<div class="form-group">
<label>Indirizzo</label>
<input type="text" id="footerAddress" placeholder="es. Via dei Fiori, 12, Roma">
</div>
<div class="form-group">
<label>Telefono</label>
<input type="tel" id="footerPhone" placeholder="es. +39 06 1234 5678">
</div>
<div class="form-group">
<label>Email</label>
<input type="email" id="footerEmail" placeholder="es. info@centroyogaroma.it">
</div>
<div class="form-group">
<label>Testo Copyright</label>
<input type="text" id="footerCopyright" placeholder="es. © 2025 Centro Yoga Roma. Tutti i diritti riservati.">
</div>
<button type="submit" class="btn btn-primary">Salva Contenuti Footer</button>
</form>
</div>
</div>

<div id="styles" class="section">
<h2 style="margin-bottom: 20px;">Gestione Stili di Yoga</h2>
<div id="stylesAlert" class="hidden"></div>
<div class="card">
    <h3>Aggiungi Nuovo Stile</h3>
    <form id="styleForm">
        <div class="form-group">
            <label>Nome Stile</label>
            <input type="text" id="styleName" placeholder="es. Hatha Yoga" required>
        </div>
        <div class="form-group">
            <label>Descrizione</label>
            <textarea id="styleDescription" placeholder="Una pratica dolce..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Salva Stile</button>
    </form>
</div>
<div class="card">
    <h3>Stili Attivi</h3>
    <div id="stylesList" class="loading">Caricamento stili...</div>
</div>
</div>

<div id="testimonials" class="section">
<h2 style="margin-bottom: 20px;">Gestione Testimonial</h2>
<div id="testimonialsAlert" class="hidden"></div>
<div class="card">
    <h3>Aggiungi Nuova Testimonianza</h3>
    <form id="testimonialForm">
        <div class="form-group">
            <label>Autore</label>
            <input type="text" id="testimonialAuthor" placeholder="es. Sofia Rossi" required>
        </div>
        <div class="form-group">
            <label>Testo</label>
            <textarea id="testimonialQuote" placeholder="Il Centro Yoga Roma è..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Salva Testimonianza</button>
    </form>
</div>
<div class="card">
    <h3>Testimonial Attivi</h3>
    <div id="testimonialsList" class="loading">Caricamento testimonianze...</div>
</div>
</div>


</div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// Configurazione Firebase
const firebaseConfig = {
    apiKey: "AIzaSyCrRemHD-6e3k1TClTxrT7UTsC8paS4Vr8",
    authDomain: "centro-yoga-roma.firebaseapp.com",
    projectId: "centro-yoga-roma",
    storageBucket: "centro-yoga-roma.firebasestorage.app",
    messagingSenderId: "1057044210787",
    appId: "1:1057044210787:web:1b84fbc8f6f081da0f4456"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// Gestione autenticazione
auth.onAuthStateChanged(user => {
    const mainContent = document.getElementById('main-content');
    const logoutButton = document.getElementById('logout-button');
    if (user) {
        // Utente loggato, mostra il contenuto
        mainContent.style.display = 'block';
        logoutButton.style.display = 'block';
        loadAllData(); // Carica tutti i dati al login
    } else {
        // Utente non loggato, reindirizza o chiedi login
        mainContent.style.display = 'none';
        logoutButton.style.display = 'none';
        const email = prompt("Inserisci la tua email di amministratore:");
        const password = prompt("Inserisci la password:");
        if (email && password) {
            auth.signInWithEmailAndPassword(email, password).catch(error => {
                alert('Errore di accesso: ' + error.message);
                window.location.reload();
            });
        } else {
            alert('Accesso negato. Ricarica la pagina per riprovare.');
        }
    }
});

document.getElementById('logout-button').addEventListener('click', () => {
    auth.signOut().then(() => {
        alert('Disconnessione riuscita.');
    }).catch(error => {
        console.error("Errore disconnessione:", error);
    });
});

function loadAllData() {
    loadDashboard();
    loadClasses();
    loadBookings();
    loadContentForms();
    loadStyles();
    loadTestimonials();
}

// Gestione Tab
function showTab(tabName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
    
    if (tabName === 'classes') loadClasses();
    if (tabName === 'bookings') loadBookings();
    if (tabName === 'dashboard') loadDashboard();
    if (tabName === 'content') loadContentForms();
    if (tabName === 'styles') loadStyles();
    if (tabName === 'testimonials') loadTestimonials();
}

function showAlert(elementId, message, type) {
    const alertDiv = document.getElementById(elementId);
    alertDiv.className = `alert alert-${type}`;
    alertDiv.textContent = message;
    alertDiv.classList.remove('hidden');
    setTimeout(() => alertDiv.classList.add('hidden'), 3000);
}

// GESTIONE LEZIONI
document.getElementById('classForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const classData = {
        name: document.getElementById('className').value,
        instructor: document.getElementById('classInstructor').value,
        day: document.getElementById('classDay').value,
        time: document.getElementById('classTime').value,
        level: document.getElementById('classLevel').value,
        maxSpots: parseInt(document.getElementById('classSpots').value),
        availableSpots: parseInt(document.getElementById('classSpots').value),
        price: parseFloat(document.getElementById('classPrice').value),
        description: document.getElementById('classDescription').value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        await db.collection('classes').add(classData);
        showAlert('classAlert', 'Lezione aggiunta con successo!', 'success');
        this.reset();
        loadClasses();
    } catch (error) {
        showAlert('classAlert', 'Errore: ' + error.message, 'error');
    }
});

async function loadClasses() {
    const list = document.getElementById('classesList');
    list.innerHTML = '<div class="loading">Caricamento...</div>';
    
    try {
        const snapshot = await db.collection('classes').get();
        
        if (snapshot.empty) {
            list.innerHTML = '<p style="text-align:center; color:#666;">Nessuna lezione trovata. Aggiungi la prima lezione!</p>';
            return;
        }
        
        list.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="item-info">
                    <h4>${data.name}</h4>
                    <p><strong>Insegnante:</strong> ${data.instructor}</p>
                    <p><strong>Orario:</strong> ${data.day}, ${data.time}</p>
                    <p><strong>Livello:</strong> ${data.level} | <strong>Posti:</strong> ${data.availableSpots}/${data.maxSpots} | <strong>Prezzo:</strong> €${data.price}</p>
                </div>
                <div class="actions">
                    <button class="btn btn-danger" onclick="deleteClass('${doc.id}')">Elimina</button>
                </div>
            `;
            list.appendChild(div);
        });
    } catch (error) {
        list.innerHTML = '<p style="color:red;">Errore nel caricamento: ' + error.message + '</p>';
    }
}

async function deleteClass(id) {
    if (!confirm('Sei sicuro di voler eliminare questa lezione?')) return;
    
    try {
        await db.collection('classes').doc(id).delete();
        showAlert('classAlert', 'Lezione eliminata!', 'success');
        loadClasses();
        loadDashboard();
    } catch (error) {
        showAlert('classAlert', 'Errore: ' + error.message, 'error');
    }
}

// GESTIONE PRENOTAZIONI
async function loadBookings() {
    const list = document.getElementById('bookingsList');
    list.innerHTML = '<div class="loading">Caricamento...</div>';
    
    try {
        const snapshot = await db.collection('bookings').orderBy('bookingDate', 'desc').limit(20).get();
        
        if (snapshot.empty) {
            list.innerHTML = '<p style="text-align:center; color:#666;">Nessuna prenotazione trovata.</p>';
            return;
        }
        
        list.innerHTML = '';
        for (const doc of snapshot.docs) {
            const data = doc.data();
            const classDoc = await db.collection('classes').doc(data.classId).get();
            const className = classDoc.exists ? classDoc.data().name : 'Lezione non trovata';
            
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="item-info">
                    <h4>${data.userName}</h4>
                    <p><strong>Email:</strong> ${data.userEmail} | <strong>Tel:</strong> ${data.userPhone || 'N/A'}</p>
                    <p><strong>Lezione:</strong> ${className}</p>
                    <p><strong>Stato:</strong> ${data.status === 'confirmed' ? '✓ Confermata' : '⏳ In attesa'}</p>
                </div>
                <div class="actions">
                    <button class="btn btn-danger" onclick="deleteBooking('${doc.id}', '${data.classId}')">Cancella</button>
                </div>
            `;
            list.appendChild(div);
        }
    } catch (error) {
        list.innerHTML = '<p style="color:red;">Errore: ' + error.message + '</p>';
    }
}

async function deleteBooking(bookingId, classId) {
    if (!confirm('Cancellare questa prenotazione?')) return;
    
    try {
        await db.collection('bookings').doc(bookingId).delete();
        await db.collection('classes').doc(classId).update({
            availableSpots: firebase.firestore.FieldValue.increment(1)
        });
        loadBookings();
        loadDashboard();
    } catch (error) {
        alert('Errore: ' + error.message);
    }
}

// DASHBOARD
async function loadDashboard() {
    try {
        const classesSnap = await db.collection('classes').get();
        const bookingsSnap = await db.collection('bookings').get();
        
        document.getElementById('totalClasses').textContent = classesSnap.size;
        document.getElementById('totalBookings').textContent = bookingsSnap.size;
        
        const today = new Date().toDateString();
        const todayBookings = bookingsSnap.docs.filter(doc => {
            const bookingDate = doc.data().bookingDate?.toDate();
            return bookingDate && bookingDate.toDateString() === today;
        });
        document.getElementById('todayBookings').textContent = todayBookings.length;
        
        let totalSpots = 0;
        classesSnap.forEach(doc => {
            totalSpots += doc.data().availableSpots || 0;
        });
        document.getElementById('availableSpots').textContent = totalSpots;
    } catch (error) {
        console.error('Errore dashboard:', error);
    }
}

// GESTIONE CONTENUTI
async function loadContentForms() {
    try {
        const homepageDoc = await db.collection('settings').doc('homepage').get();
        if (homepageDoc.exists) {
            const data = homepageDoc.data();
            document.getElementById('homeTitle').value = data.title || '';
            document.getElementById('homeSubtitle').value = data.subtitle || '';
            document.getElementById('homeDescription').value = data.description || '';
            document.getElementById('homeStylesTitle').value = data.stylesTitle || '';
            document.getElementById('homeStylesSubtitle').value = data.stylesSubtitle || '';
            document.getElementById('homeTestimonialsTitle').value = data.testimonialsTitle || '';
            document.getElementById('homeScheduleTitle').value = data.scheduleTitle || '';
            document.getElementById('homeScheduleSubtitle').value = data.scheduleSubtitle || '';
        }
        
        const footerDoc = await db.collection('settings').doc('footer').get();
        if (footerDoc.exists) {
            const data = footerDoc.data();
            document.getElementById('footerAddress').value = data.address || '';
            document.getElementById('footerPhone').value = data.phone || '';
            document.getElementById('footerEmail').value = data.email || '';
            document.getElementById('footerCopyright').value = data.copyright || '';
        }
    } catch (error) {
        console.error("Errore nel caricamento dei contenuti:", error);
    }
}

document.getElementById('homepageForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    try {
        await db.collection('settings').doc('homepage').set({
            title: document.getElementById('homeTitle').value,
            subtitle: document.getElementById('homeSubtitle').value,
            description: document.getElementById('homeDescription').value,
            stylesTitle: document.getElementById('homeStylesTitle').value,
            stylesSubtitle: document.getElementById('homeStylesSubtitle').value,
            testimonialsTitle: document.getElementById('homeTestimonialsTitle').value,
            scheduleTitle: document.getElementById('homeScheduleTitle').value,
            scheduleSubtitle: document.getElementById('homeScheduleSubtitle').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        showAlert('contentAlert', 'Contenuti homepage aggiornati!', 'success');
    } catch (error) {
        showAlert('contentAlert', 'Errore: ' + error.message, 'error');
    }
});

document.getElementById('footerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    try {
        await db.collection('settings').doc('footer').set({
            address: document.getElementById('footerAddress').value,
            phone: document.getElementById('footerPhone').value,
            email: document.getElementById('footerEmail').value,
            copyright: document.getElementById('footerCopyright').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        showAlert('contentAlert', 'Contenuti footer aggiornati!', 'success');
    } catch (error) {
        showAlert('contentAlert', 'Errore: ' + error.message, 'error');
    }
});

// GESTIONE STILI DI YOGA
document.getElementById('styleForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const styleData = {
        name: document.getElementById('styleName').value,
        description: document.getElementById('styleDescription').value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    try {
        await db.collection('yogaStyles').add(styleData);
        showAlert('stylesAlert', 'Stile di yoga aggiunto!', 'success');
        this.reset();
        loadStyles();
    } catch (error) {
        showAlert('stylesAlert', 'Errore: ' + error.message, 'error');
    }
});

async function loadStyles() {
    const list = document.getElementById('stylesList');
    list.innerHTML = '<div class="loading">Caricamento...</div>';
    try {
        const snapshot = await db.collection('yogaStyles').get();
        if (snapshot.empty) {
            list.innerHTML = '<p style="text-align:center; color:#666;">Nessuno stile di yoga trovato.</p>';
            return;
        }
        list.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="item-info">
                    <h4>${data.name}</h4>
                    <p>${data.description}</p>
                </div>
                <div class="actions">
                    <button class="btn btn-danger" onclick="deleteStyle('${doc.id}')">Elimina</button>
                </div>
            `;
            list.appendChild(div);
        });
    } catch (error) {
        list.innerHTML = '<p style="color:red;">Errore: ' + error.message + '</p>';
    }
}

async function deleteStyle(id) {
    if (!confirm('Sei sicuro di voler eliminare questo stile?')) return;
    try {
        await db.collection('yogaStyles').doc(id).delete();
        showAlert('stylesAlert', 'Stile eliminato!', 'success');
        loadStyles();
    } catch (error) {
        showAlert('stylesAlert', 'Errore: ' + error.message, 'error');
    }
}

// GESTIONE TESTIMONIAL
document.getElementById('testimonialForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const testimonialData = {
        author: document.getElementById('testimonialAuthor').value,
        quote: document.getElementById('testimonialQuote').value,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    try {
        await db.collection('testimonials').add(testimonialData);
        showAlert('testimonialsAlert', 'Testimonianza aggiunta!', 'success');
        this.reset();
        loadTestimonials();
    } catch (error) {
        showAlert('testimonialsAlert', 'Errore: ' + error.message, 'error');
    }
});

async function loadTestimonials() {
    const list = document.getElementById('testimonialsList');
    list.innerHTML = '<div class="loading">Caricamento...</div>';
    try {
        const snapshot = await db.collection('testimonials').get();
        if (snapshot.empty) {
            list.innerHTML = '<p style="text-align:center; color:#666;">Nessuna testimonianza trovata.</p>';
            return;
        }
        list.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <div class="item-info">
                    <h4>${data.author}</h4>
                    <p>${data.quote}</p>
                </div>
                <div class="actions">
                    <button class="btn btn-danger" onclick="deleteTestimonial('${doc.id}')">Elimina</button>
                </div>
            `;
            list.appendChild(div);
        });
    } catch (error) {
        list.innerHTML = '<p style="color:red;">Errore: ' + error.message + '</p>';
    }
}

async function deleteTestimonial(id) {
    if (!confirm('Sei sicuro di voler eliminare questa testimonianza?')) return;
    try {
        await db.collection('testimonials').doc(id).delete();
        showAlert('testimonialsAlert', 'Testimonianza eliminata!', 'success');
        loadTestimonials();
    } catch (error) {
        showAlert('testimonialsAlert', 'Errore: ' + error.message, 'error');
    }
}
</script>

</body>
</html>
